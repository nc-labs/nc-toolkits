function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=require("react-router-dom"),r=require("react"),n=e(r),o=e(require("lodash")),i=e(require("styled-components")),a=require("ahooks"),c=require("nc-simple-loading"),u=require("history");function l(e,t){return t||(t=e.slice(0)),e.raw=t,e}var s,f=n.memo(function(e){return n.createElement(n.Fragment,null,e.error," ",n.createElement("button",{onClick:e.onReload},"Re-fetch"))}),m=n.memo(function(){return n.createElement(h,null,n.createElement(c.Loading,null))}),h=i.div(s||(s=l(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  z-index: 999999999;\n  background: white;\n  display: flex;\n  align-items: center;\n  justify-contents: space-between;\n"]))),d=n.memo(function(e){var t=e.factory,o=e.children,i=a.useBoolean(!t.isFetched),c=i[0],u=i[1],l=u.setTrue,s=u.setFalse,h=r.useCallback(function(){t.isFetched||(l(),Promise.all([new Promise(function(e){return setTimeout(e,1e3)}),t.fetch()]).finally(s))},[t.isFetched]);return r.useLayoutEffect(h,[t.isFetched]),c?n.createElement(m,null):t.error?n.createElement(f,{error:t.error,onReload:h}):n.createElement(t.Component,null,o)}),y=function(){var e=r.useRef(null),t=a.useSize(e);return[e,r.useMemo(function(){return(null==t?void 0:t.height)||0},[t])]};"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var p,v,g=function(e){var t=this;this.isFetched=!1,this.Component=m,this.error="",this.fetch=function(){try{var e=function(e,n){try{var o=Promise.resolve(t.factory()).then(function(e){var n=e.default;n.factories&&Promise.all(n.factories.map(function(e){return e.fetch()})),t.Component=r.memo(n),t.isFetched=!0,t.error=""})}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){console.error("[nc-toolkits]",e.message),t.error=e.message});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},this.factory=e},E=function(e){var t=o.pickBy((void 0)("/src/{layouts,pages}/**/*.tsx"),function(t,r){return o.startsWith(r,e)}),r={};for(var n in t)r[n.replace(e,"").replace(/\.tsx$/,"").replace(/^\//,"")]=t[n];return r},b=function(e,t){var r=function(e){var t={},r=E("/src/layouts/"+e);for(var n in r)t[n]=new g(r[n]);return t}(e);return"none"!==t&&r&&(r[t]||r.index)||null},x=i.main(p||(p=l(["\n  min-height: ",";\n"])),function(e){var t=e.headerHeight,r=e.footerHeight;return"calc(100vh - "+((void 0===t?0:t)+(void 0===r?0:r))+"px)"}),w=i.header(v||(v=l(["\n  position: sticky;\n  top: 0;\n  left: 0;\n  background: white;\n  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n"]))),k=u.createBrowserHistory(),S=function(e){var t=function(e){return["/",e.replace(/index$/,"").toLowerCase()].join("")}(e);return/^(\/[a-z][^\]/\s]*|\/\[[a-z][^/\s]*\])+$|^\/$/g.test(t)?t=function(e){return e.split(/\]/).join("").split(/\/\[/).join("/:")}(t):(console.warn("[nc-toolkits]",e,"is invalid path."),null)},F=function(){var e=E("/src/pages"),t=E("/src/pages/404.tsx")[""],r=[];for(var i in e){var a=S(i);if(a){var c=new g(e[i]);r.push({path:a,factory:c,element:n.createElement(d,{factory:c})})}}var u=r.map(function(e){return o.pick(e,["path","element"])}),l=r.map(function(e){return o.pick(e,["path","factory"])});if(t){var s=new g(E("/src/pages/404.tsx")[""]);u.push({path:"*",element:n.createElement(d,{factory:s})})}return{routes:u,routePreloads:l}}(),P=F.routes,j=F.routePreloads,R=n.memo(n.forwardRef(function(e,o){var i=r.useRef((null==o?void 0:o.current)||o||null),c=a.useInViewport(i)[0],u=r.useMemo(function(){return"string"==typeof e.to?e.to:e.to.pathname},[JSON.stringify(e.to)]),l=r.useMemo(function(){return j.find(function(e){return t.matchPath(e.path,u)})},[u]);return r.useEffect(function(){c&&l&&l.factory&&(l.factory.isFetched||l.factory.fetch())},[c]),n.createElement(t.Link,Object.assign({},e,{ref:i}))})),q=r.memo(function(){return t.useRoutes(P)}),H=r.memo(function(){return n.createElement(t.unstable_HistoryRouter,{history:k},n.createElement(q,null))});Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})}),exports.HistoryRouter=H,exports.Link=R,exports.history=k,exports.withNcLayout=function(e,t){var i=r.memo(e),a=b("headers",(null==t?void 0:t.header)||"index"),c=b("contents",(null==t?void 0:t.content)||"index"),u=b("footers",(null==t?void 0:t.footer)||"index"),l=function(){var e=y(),t=e[0],o=e[1],l=y(),s=l[0],f=l[1];return n.createElement(r.Fragment,null,a&&n.createElement(w,{ref:t},n.createElement(d,{factory:a})),c?n.createElement(x,{headerHeight:o,footerHeight:f},n.createElement(d,{factory:c},n.createElement(i,null))):n.createElement("main",null,n.createElement(i,null)),u&&n.createElement("footer",{ref:s},n.createElement(d,{factory:u})))};return o.set(l,"factories",[a,c,u].filter(function(e){return e})),l};
//# sourceMappingURL=index.js.map
