function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t,n=require("react-router-dom"),r=require("react"),o=e(r),i=require("ahooks"),u=require("history"),c=e(require("lodash")),a=require("nc-simple-loading"),s=e(require("styled-components")),f={useWatcher:function(e,t){i.useEventListener(e,function(e){t(e.detail)})},emitWatcher:function(e,t){return window.dispatchEvent(new CustomEvent(e,{detail:t}))}},l=u.createBrowserHistory(),h=o.memo(function(e){return o.createElement(o.Fragment,null,e.error," ",o.createElement("button",{onClick:e.onReload},"Re-fetch"))});function m(){return(m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function d(e,t){return t||(t=e.slice(0)),e.raw=t,e}var v=o.memo(function(){return o.createElement(p,null,o.createElement(a.Loading,null))}),p=s.div(t||(t=d(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  z-index: 999999999;\n  background: white;\n  display: flex;\n  align-items: center;\n  justify-contents: space-between;\n"]))),y=o.memo(function(e){var t=e.factory,n=e.children,u=i.useBoolean(!t.isFetched),c=u[0],a=u[1],s=a.setTrue,f=a.setFalse,l=r.useCallback(function(){t.isFetched||(s(),Promise.all([new Promise(function(e){return setTimeout(e,1e3)}),t.fetch()]).finally(f))},[t.isFetched]);return r.useLayoutEffect(l,[t.isFetched]),c?o.createElement(v,null):t.error?o.createElement(h,{error:t.error,onReload:l}):o.createElement(t.Component,null,n)});const b=function(){function e(){}return e.prototype.then=function(t,n){const r=new e,o=this.s;if(o){const e=1&o?t:n;if(e){try{E(r,1,e(this.v))}catch(e){E(r,2,e)}return r}return this}return this.o=function(e){try{const o=e.v;1&e.s?E(r,1,t?t(o):o):n?E(r,1,n(o)):E(r,2,o)}catch(e){E(r,2,e)}},r},e}();function E(e,t,n){if(!e.s){if(n instanceof b){if(!n.s)return void(n.o=E.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(E.bind(null,e,t),E.bind(null,e,2));e.s=t,e.v=n;const r=e.o;r&&r(e)}}function g(e){return e instanceof b&&1&e.s}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var w,x,k=function(e){var t=this;this.isFetched=!1,this.Component=v,this.error="",this.fetch=function(){try{var e=!1,n=0;return Promise.resolve(function(e,t,n){for(var r;;){var o=e();if(g(o)&&(o=o.v),!o)return i;if(o.then){r=0;break}var i=n();if(i&&i.then){if(!g(i)){r=1;break}i=i.s}if(t){var u=t();if(u&&u.then&&!g(u)){r=2;break}}}var c=new b,a=E.bind(null,c,2);return(0===r?o.then(f):1===r?i.then(s):u.then(l)).then(void 0,a),c;function s(r){i=r;do{if(t&&(u=t())&&u.then&&!g(u))return void u.then(l).then(void 0,a);if(!(o=e())||g(o)&&!o.v)return void E(c,1,i);if(o.then)return void o.then(f).then(void 0,a);g(i=n())&&(i=i.v)}while(!i||!i.then);i.then(s).then(void 0,a)}function f(e){e?(i=n())&&i.then?i.then(s).then(void 0,a):s(i):E(c,1,i)}function l(){(o=e())?o.then?o.then(f).then(void 0,a):f(o):E(c,1,i)}}(function(){return!e&&n<3},function(){return n++},function(){var r=function(n,r){try{var o=Promise.resolve(t.factory()).then(function(n){t.Component=n.default,t.isFetched=!0,t.error="",e=!0})}catch(e){return r(e)}return o&&o.then?o.then(void 0,r):o}(0,function(e){2===n&&(console.error("[nc-toolkits]",e.message),t.error=e.message)});if(r&&r.then)return r.then(function(){})}))}catch(e){return Promise.reject(e)}},this.factory=e},j=function(e){var t=c.pickBy((void 0)("/src/{layouts,pages}/**/*.tsx"),function(t,n){return c.startsWith(n,e)}),n={},r=function(t){var r=t.replace(e,"").replace(/\.tsx$/,"").replace(/^\//,"");n[r]=function(){return new Promise(function(e){e(function(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach(function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}),t.default=e,t}(require(t+"?t="+Date.now())))})}};for(var o in t)r(o);return n},S=function(e){return["/",e.replace(/index$/,"").toLowerCase()].join("")},O=function(e){return e.split(/\]/).join("").split(/\/\[/).join("/:")},P=function(){var e=j("/src/pages"),t=[];for(var n in e){var r=S(n);if(/^(\/[a-z][^\]/\s]*|\/\[[a-z][^/\s]*\])+$|^\/$/g.test(r)){r=O(r);var i=new k(e[n]);t.push({path:r,factory:i,element:o.createElement(y,{factory:i})})}else console.warn("[nc-toolkits]",n,"is invalid path.")}return{routes:t.map(function(e){return c.pick(e,["path","element"])}),routePreloads:t.map(function(e){return c.pick(e,["path","factory"])})}}(),L=P.routes,F=P.routePreloads,C=o.memo(o.forwardRef(function(e,t){var u=r.useRef((null==t?void 0:t.current)||t||null),c=i.useInViewport(u)[0],a=r.useMemo(function(){return"string"==typeof e.to?e.to:e.to.pathname},[JSON.stringify(e.to)]),s=r.useMemo(function(){return F.find(function(e){return n.matchPath(e.path,a)})},[a]);return r.useEffect(function(){c&&s&&s.factory&&(s.factory.isFetched||s.factory.fetch())},[c]),o.createElement(n.Link,Object.assign({},e,{ref:u}))})),R=function(){var e=r.useRef(null),t=i.useSize(e);return[e,r.useMemo(function(){return(null==t?void 0:t.height)||0},[t])]},q=function(e){var t={},n=j("/src/layouts/"+e);for(var r in n)t[r]=new k(n[r]);return t},H={headers:q("headers"),footers:q("footers"),contents:q("contents")},M=o.memo(function(e){var t=e.name,n=e.children,i=e.component,u=r.useMemo(function(){var e=H[i];return"none"!==t&&e&&(e[t]||e.index)||null},[i,t]);return u?o.createElement(y,{factory:u},n):o.createElement(o.Fragment,null,n)}),W=o.memo(function(){var e=l.location.pathname,t=r.useState({}),i=t[0],u=t[1],c=r.useMemo(function(){return i[e]},[i,e]),a=R(),s=a[0],h=a[1],d=R(),v=d[0],p=d[1];return f.useWatcher("CHANGE_LAYOUTS",function(e){u(function(t){return m({},t,e)})}),o.createElement(n.unstable_HistoryRouter,{history:l},(null==c?void 0:c.header)&&o.createElement(z,{ref:s},o.createElement(M,{component:"headers",name:c.header})),(null==c?void 0:c.content)&&o.createElement(_,{headerHeight:h,footerHeight:p},o.createElement(M,{component:"contents",name:null==c?void 0:c.content},o.createElement(A,null))),Boolean(null==c?void 0:c.content)||o.createElement("main",null,o.createElement(A,null)),(null==c?void 0:c.footer)&&o.createElement("footer",{ref:v},o.createElement(M,{component:"footers",name:null==c?void 0:c.footer})))}),_=s.main(w||(w=d(["\n  min-height: ",";\n"])),function(e){var t=e.headerHeight,n=e.footerHeight;return"calc(100vh - "+((void 0===t?0:t)+(void 0===n?0:n))+"px)"}),z=s.header(x||(x=d(["\n  position: sticky;\n  top: 0;\n  left: 0;\n  background: white;\n  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n"]))),A=o.memo(function(){return n.useRoutes(L)});Object.keys(n).forEach(function(e){"default"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return n[e]}})}),exports.Link=C,exports.Router=W,exports.history=l,exports.watcher=f,exports.withLayout=function(e,t){return function(){var i=n.useLocation().pathname;return r.useLayoutEffect(function(){var e;f.emitWatcher("CHANGE_LAYOUTS",((e={})[i]={header:(null==t?void 0:t.header)||"index",content:(null==t?void 0:t.content)||"index",footer:(null==t?void 0:t.footer)||"index"},e))},[]),o.createElement(e,null)}};
//# sourceMappingURL=index.js.map
