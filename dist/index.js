function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=require("react-router-dom"),n=require("react"),r=e(n),o=require("ahooks"),i=require("history"),u=e(require("lodash")),c=require("nc-simple-loading"),a=e(require("styled-components")),s={useWatcher:function(e,t){o.useEventListener(e,function(e){t(e.detail)})},emitWatcher:function(e,t){return window.dispatchEvent(new CustomEvent(e,{detail:t}))}},f=i.createBrowserHistory(),l=r.memo(function(e){var t=e.factory,i=e.children,u=o.useUpdate();return n.useEffect(function(){t.isFetched||Promise.all([new Promise(function(e){return setTimeout(e,1e3)}),t.fetch()]).then(function(){return u()})},[]),r.createElement(t.Component,null,i)});const h=function(){function e(){}return e.prototype.then=function(t,n){const r=new e,o=this.s;if(o){const e=1&o?t:n;if(e){try{d(r,1,e(this.v))}catch(e){d(r,2,e)}return r}return this}return this.o=function(e){try{const o=e.v;1&e.s?d(r,1,t?t(o):o):n?d(r,1,n(o)):d(r,2,o)}catch(e){d(r,2,e)}},r},e}();function d(e,t,n){if(!e.s){if(n instanceof h){if(!n.s)return void(n.o=d.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(d.bind(null,e,t),d.bind(null,e,2));e.s=t,e.v=n;const r=e.o;r&&r(e)}}function m(e){return e instanceof h&&1&e.s}function v(){return(v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(e,t){return t||(t=e.slice(0)),e.raw=t,e}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var y,b,x,E=r.memo(function(){return r.createElement(g,null,r.createElement(c.Loading,null))}),g=a.div(y||(y=p(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  z-index: 999999999;\n  background: white;\n  display: flex;\n  align-items: center;\n  justify-contents: space-between;\n"]))),w=function(e,t){var n=this;this.isFetched=!1,this.Component=E,this.fetch=function(){try{var e=!1,t=0;return Promise.resolve(function(e,t,n){for(var r;;){var o=e();if(m(o)&&(o=o.v),!o)return i;if(o.then){r=0;break}var i=n();if(i&&i.then){if(!m(i)){r=1;break}i=i.s}if(t){var u=t();if(u&&u.then&&!m(u)){r=2;break}}}var c=new h,a=d.bind(null,c,2);return(0===r?o.then(f):1===r?i.then(s):u.then(l)).then(void 0,a),c;function s(r){i=r;do{if(t&&(u=t())&&u.then&&!m(u))return void u.then(l).then(void 0,a);if(!(o=e())||m(o)&&!o.v)return void d(c,1,i);if(o.then)return void o.then(f).then(void 0,a);m(i=n())&&(i=i.v)}while(!i||!i.then);i.then(s).then(void 0,a)}function f(e){e?(i=n())&&i.then?i.then(s).then(void 0,a):s(i):d(c,1,i)}function l(){(o=e())?o.then?o.then(f).then(void 0,a):f(o):d(c,1,i)}}(function(){return!e&&t<3},function(){return t++},function(){var t=function(t,r){try{var o=Promise.resolve(n.factory()).then(function(t){n.Component=t.default,n.isFetched=!0,e=!0})}catch(e){return}return o&&o.then?o.then(void 0,function(){}):o}();if(t&&t.then)return t.then(function(){})}))}catch(e){return Promise.reject(e)}},this.factory=e,this.path=t||""},S=function(){var e=(void 0)("/src/pages/**/[a-z[]*.tsx"),t=[];for(var n in e){var o=n.split(/\/src\/pages|\.tsx$|\/index\.tsx$/g).join("").toLowerCase()||"/";if(/^(\/[a-z][^\]/\s]*|\/\[[a-z][^/\s]*\])+$|^\/$/g.test(o)){o=o.split(/\]/).join("").split(/\/\[/).join("/:");var i=new w(e[n]);t.push({path:o,factory:i,element:r.createElement(l,{factory:i})})}else console.warn("[nc-toolkits]",n,"is invalid path.")}return{routes:t.map(function(e){return u.pick(e,["path","element"])}),routePreloads:t.map(function(e){return u.pick(e,["path","factory"])})}}(),k=S.routes,j=S.routePreloads,L=r.memo(r.forwardRef(function(e,i){var u=n.useRef((null==i?void 0:i.current)||i||null),c=o.useInViewport(u)[0],a=n.useMemo(function(){return"string"==typeof e.to?e.to:e.to.pathname},[JSON.stringify(e.to)]),s=n.useMemo(function(){return j.find(function(e){return t.matchPath(e.path,a)})},[a]);return n.useEffect(function(){c&&s&&s.factory&&(s.factory.isFetched||s.factory.fetch())},[c]),r.createElement(t.Link,Object.assign({},e,{ref:u}))})),O=function(){var e=n.useRef(null),t=o.useSize(e);return[e,n.useMemo(function(){return(null==t?void 0:t.height)||0},[t])]},P=function(e){var t={},n=function(e){switch(e){case"headers":return(void 0)("/src/layouts/headers/*.tsx");case"footers":return(void 0)("/src/layouts/footers/*.tsx");case"contents":return(void 0)("/src/layouts/contents/*.tsx");default:return{}}}(e);for(var r in n)t[r.split(new RegExp("/src/layouts/"+e+"/|.tsx$|/index.tsx$","g")).join("")||"index"]=new w(n[r]);return t},H={headers:P("headers"),footers:P("footers"),contents:P("contents")},q=r.memo(function(e){var t=e.name,o=e.children,i=e.component,u=n.useMemo(function(){var e=H[i];return"none"!==t&&e&&(e[t]||e.index)||null},[i,t]);return u?r.createElement(l,{factory:u},o):r.createElement(r.Fragment,null,o)}),C=r.memo(function(e){var o=e.fallback,i=f.location.pathname,u=n.useState({}),c=u[0],a=u[1],l=n.useMemo(function(){return c[i]},[c,i]),h=O(),d=h[0],m=h[1],p=O(),y=p[0],b=p[1];return s.useWatcher("CHANGE_LAYOUTS",function(e){a(function(t){return v({},t,e)})}),r.createElement(t.unstable_HistoryRouter,{history:f},r.createElement(n.Suspense,{fallback:o},(null==l?void 0:l.header)&&r.createElement($,{ref:d},r.createElement(q,{component:"headers",name:l.header})),(null==l?void 0:l.content)&&r.createElement(R,{headerHeight:m,footerHeight:b},r.createElement(q,{component:"contents",name:null==l?void 0:l.content},r.createElement(z,null))),Boolean(null==l?void 0:l.content)||r.createElement("main",null,r.createElement(z,null)),(null==l?void 0:l.footer)&&r.createElement("footer",{ref:y},r.createElement(q,{component:"footers",name:null==l?void 0:l.footer}))))}),R=a.main(b||(b=p(["\n  min-height: ",";\n"])),function(e){var t=e.headerHeight,n=e.footerHeight;return"calc(100vh - "+((void 0===t?0:t)+(void 0===n?0:n))+"px)"}),$=a.header(x||(x=p(["\n  position: sticky;\n  top: 0;\n  left: 0;\n  background: white;\n  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n"]))),z=r.memo(function(){return t.useRoutes(k)});Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})}),exports.Link=L,exports.Router=C,exports.history=f,exports.watcher=s,exports.withLayout=function(e,o){return function(){var i=t.useLocation().pathname;return n.useLayoutEffect(function(){var e;s.emitWatcher("CHANGE_LAYOUTS",((e={})[i]={header:(null==o?void 0:o.header)||"index",content:(null==o?void 0:o.content)||"index",footer:(null==o?void 0:o.footer)||"index"},e))},[]),r.createElement(e,null)}};
//# sourceMappingURL=index.js.map
