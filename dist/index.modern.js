import{useLocation as e,matchPath as t,Link as o,unstable_HistoryRouter as n,useRoutes as r}from"react-router-dom";export*from"react-router-dom";import a,{useLayoutEffect as s,useEffect as c,useRef as l,useMemo as i,useState as m,Suspense as h}from"react";import{useEventListener as d,useUpdate as u,useInViewport as f,useSize as p}from"ahooks";import{createBrowserHistory as g}from"history";import x from"lodash";import{Loading as y}from"nc-simple-loading";import E from"styled-components";const v={useWatcher:(e,t)=>{d(e,({detail:e})=>{t(e)})},emitWatcher:(e,t)=>window.dispatchEvent(new CustomEvent(e,{detail:t}))},w=(t,o)=>()=>{const{pathname:n}=e();return s(()=>{v.emitWatcher("CHANGE_LAYOUTS",{[n]:{header:(null==o?void 0:o.header)||"index",content:(null==o?void 0:o.content)||"index",footer:(null==o?void 0:o.footer)||"index"}})},[]),a.createElement(t,null)},b=g(),k=a.memo(({factory:e,children:t})=>{const o=u();return c(()=>{e.isFetched||Promise.all([new Promise(e=>setTimeout(e,1e3)),e.fetch()]).then(()=>o())},[]),a.createElement(e.Component,null,t)});let $;const C=a.memo(()=>a.createElement(j,null,a.createElement(y,null))),j=E.div($||($=(e=>e)`
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  z-index: 999999999;
  background: white;
  display: flex;
  align-items: center;
  justify-contents: space-between;
`));class H{constructor(e,t){var o=this;this.isFetched=!1,this.Component=C,this.fetch=async function(){for(let e=0;e<3;e++)try{const{default:e}=await o.factory();o.Component=e,o.isFetched=!0;break}catch(e){}},this.factory=e,this.path=t||""}}const{routes:F,routePreloads:L}=(()=>{const e=import.meta.glob("/src/pages/**/[a-z[]*.tsx"),t=[];for(const o in e){const n=/^(\/[a-z][^\]/\s]*|\/\[[a-z][^/\s]*\])+$|^\/$/g;let r=o.split(/\/src\/pages|\.tsx$|\/index\.tsx$/g).join("").toLowerCase()||"/";if(!n.test(r)){console.warn("[nc-toolkits]",o,"is invalid path.");continue}r=r.split(/\]/).join("").split(/\/\[/).join("/:");const s=new H(e[o]);t.push({path:r,factory:s,element:a.createElement(k,{factory:s})})}return{routes:t.map(e=>x.pick(e,["path","element"])),routePreloads:t.map(e=>x.pick(e,["path","factory"]))}})(),z=a.memo(a.forwardRef((e,n)=>{const r=l((null==n?void 0:n.current)||n||null),[s]=f(r),m=i(()=>"string"==typeof e.to?e.to:e.to.pathname,[JSON.stringify(e.to)]),h=i(()=>L.find(e=>t(e.path,m)),[m]);return c(()=>{s&&h&&h.factory&&(h.factory.isFetched||h.factory.fetch())},[s]),a.createElement(o,Object.assign({},e,{ref:r}))})),A=()=>{const e=l(null),t=p(e);return[e,i(()=>(null==t?void 0:t.height)||0,[t])]},O=e=>{const t={},o=(e=>{switch(e){case"headers":return import.meta.glob("/src/layouts/headers/*.tsx");case"footers":return import.meta.glob("/src/layouts/footers/*.tsx");case"contents":return import.meta.glob("/src/layouts/contents/*.tsx");default:return{}}})(e);for(const n in o)t[n.split(new RegExp(`/src/layouts/${e}/|.tsx$|/index.tsx$`,"g")).join("")||"index"]=new H(o[n]);return t},P={headers:O("headers"),footers:O("footers"),contents:O("contents")},W=a.memo(({name:e,children:t,component:o})=>{const n=i(()=>{const t=P[o];return"none"!==e&&t&&(t[e]||t.index)||null},[o,e]);return n?a.createElement(k,{factory:n},t):a.createElement(a.Fragment,null,t)});let N,S,T=e=>e;const G=a.memo(({fallback:e})=>{const t=b.location.pathname,[o,r]=m({}),s=i(()=>o[t],[o,t]),[c,l]=A(),[d,u]=A();return v.useWatcher("CHANGE_LAYOUTS",e=>{r(t=>({...t,...e}))}),a.createElement(n,{history:b},a.createElement(h,{fallback:e},(null==s?void 0:s.header)&&a.createElement(U,{ref:c},a.createElement(W,{component:"headers",name:s.header})),(null==s?void 0:s.content)&&a.createElement(R,{headerHeight:l,footerHeight:u},a.createElement(W,{component:"contents",name:null==s?void 0:s.content},a.createElement(Y,null))),Boolean(null==s?void 0:s.content)||a.createElement("main",null,a.createElement(Y,null)),(null==s?void 0:s.footer)&&a.createElement("footer",{ref:d},a.createElement(W,{component:"footers",name:null==s?void 0:s.footer}))))}),R=E.main(N||(N=T`
  min-height: ${0};
`),({headerHeight:e=0,footerHeight:t=0})=>`calc(100vh - ${e+t}px)`),U=E.header(S||(S=T`
  position: sticky;
  top: 0;
  left: 0;
  background: white;
  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
`)),Y=a.memo(()=>r(F));export{z as Link,G as Router,b as history,v as watcher,w as withLayout};
//# sourceMappingURL=index.modern.js.map
